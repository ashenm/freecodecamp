<!--

  Use the Twitchtv JSON API
  https://codepen.io/ashenm/pen/______
  https://www.freecodecamp.org/challenges/use-the-twitchtv-json-api

  Ashen Gunaratne
  mail@ashenm.ml

-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="" />
  <meta name="keywords" content="ashen m. gunaratne freecodecamp projects intermediate" />
  <meta name="author" content="Ashen Gunaratne" />
  <title>Twitchtv</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous" />
  <style type="text/css">
    .table {
      max-width: 400px;
      margin-top: 81px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
  <script type="text/javascript">

    const routes = ['channels', 'streams'];
    const endpoint = 'https://wind-bow.gomix.me/twitch-api';
    const channels = ["ESL_SC2", "OgamingSC2", "cretetion", "freecodecamp", "storbeck", "habathcx", "RobotCaleb", "noobs2ninjas"];

    // on DOM ready
    $(() => {

      channels.forEach(channel => {

        // pre populate with ids
        $('tbody').append(`<tr id="${channel}"></tr>`);

        // append data
        routes.forEach(route => twitch(route, channel, data => {
          render(route, channel, data);
        }));

      });

    });

    function twitch(route, channel, callback) {
      const url = `${endpoint}/${route}/${channel}?callback=?`;
      $.getJSON(url, callback);
    }

    function render(segment, channel, data) {
      switch (segment) {
        case 'channels':
          $(`#${channel}`).prepend(`<td><a href="https://www.twitch.tv/${channel}">${data.display_name}</a></td>`);
          break;
        case 'streams':
          $(`#${channel}`).append(`<td>${(data.stream === null) ? 'Offline' : data.stream.game}</td>`);
          break;
        default:
          return;
      }
    }

  </script>
</head>
<body>
  <div class="container">
    <main>
      <table class="table table-bordered table-striped">
        <caption class="text-center">Twitch Streamers</caption>
        <thead>
          <tr>
            <th>Channel</th>
            <th>On air</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </main>
  </div>
</body>
</html>